<div class="app-container">
  <!-- Global Header with Overall Progress Badge and Generate Schema Button -->
  <mat-toolbar class="app-toolbar" color="primary">
    <span class="app-title">{{ title() }}</span>
    <span class="spacer"></span>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-input-container">
        <input
          class="search-input"
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          placeholder="Search columns..."
          autocomplete="off">
        <mat-icon *ngIf="searchLoading()" class="search-icon loading">refresh</mat-icon>
        <mat-icon *ngIf="!searchLoading() && searchQuery()" (click)="clearSearch()" class="search-icon clear-icon">clear</mat-icon>
      </div>

      <!-- Search Results Dropdown -->
      <div class="search-results" *ngIf="showSearchResults() && searchResults().length > 0" (mousedown)="onSearchResultClick($event)">
        <div class="search-result-item" *ngFor="let result of searchResults()" (click)="onSearchResultItemClick(result)">
          <div class="result-main">
            <div class="column-name">{{ result.column_name }}</div>
            <div class="table-name">{{ result.table_name }}</div>
            <div class="match-type" [class.exact]="result.match_type === 'exact'">
              {{ result.match_type }}
            </div>
          </div>
          <div class="mapped-categories" *ngIf="result.mapped_categories && result.mapped_categories.length > 0">
            <div class="categories-label">Used in categories:</div>
            <div class="category-links">
              <button
                *ngFor="let category of result.mapped_categories"
                mat-button
                class="category-link"
                (mousedown)="navigateToCategory(category.id); $event.preventDefault(); $event.stopPropagation()">
                {{ category.name }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- No Results Message -->
      <div class="search-results no-results" *ngIf="showSearchResults() && searchResults().length === 0 && !searchLoading() && searchQuery().length >= 2">
        <div class="no-results-message">No columns found matching "{{ searchQuery() }}"</div>
      </div>

      <!-- Error Message -->
      <div class="search-results error" *ngIf="searchError()">
        <div class="error-message">{{ searchError() }}</div>
      </div>
    </div>



    <!-- Overall Progress Badge -->
    <mat-chip-set class="progress-chip-set">
      <mat-chip
        class="overall-progress-chip"
        [class.completed]="overallProgress() === 100"
        matTooltip="Overall mapping progress across all categories"
        matTooltipPosition="below">
        <mat-icon matChipAvatar>assessment</mat-icon>
        Overall: {{ overallProgress() }}%
      </mat-chip>
    </mat-chip-set>

    <!-- GitHub status -->
    @if (githubConnectionLoading()) {
      <span class="github-status">GitHub: Checkingâ€¦</span>
    } @else if (githubConnected() === false) {
      <span class="github-status">GitHub: Not connected</span>
      <button
        mat-button
        (click)="openConnectGitHubDialog()"
        class="github-connect-btn"
        matTooltip="Connect GitHub to create pull requests"
        matTooltipPosition="below">
        <mat-icon>link</mat-icon>
        Connect GitHub
      </button>
    } @else if (githubConnected() === true) {
      <span class="github-status">GitHub: Connected</span>
      <button
        mat-icon-button
        [matMenuTriggerFor]="githubMenu"
        matTooltip="GitHub options"
        matTooltipPosition="below">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #githubMenu="matMenu">
        <button mat-menu-item (click)="openConnectGitHubDialog()">
          <mat-icon>refresh</mat-icon>
          <span>Update token</span>
        </button>
        <button mat-menu-item (click)="disconnectGithub()">
          <mat-icon>link_off</mat-icon>
          <span>Disconnect</span>
        </button>
      </mat-menu>
    }

    <button
      mat-raised-button
      (click)="openPushSchemaDialog()"
      class="generate-schema-btn"
      matTooltip="Create a pull request with schema-config.json"
      matTooltipPosition="below">
      <mat-icon>pin_invoke</mat-icon>
      Push schema-config
    </button>

    <button
      mat-raised-button
      color="primary"
      (click)="generateUploadConfig()"
      class="generate-schema-btn"
      matTooltip="Generate Upload Configuration File"
      matTooltipPosition="below">
      <mat-icon>build</mat-icon>
      Generate Upload Config
    </button>

    <button
      mat-raised-button
      color="warn"
      (click)="generateSchema()"
      class="generate-schema-btn"
      matTooltip="Generate Schema Configuration File"
      matTooltipPosition="below">
      <mat-icon>download</mat-icon>
      Generate Schema
    </button>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="main-content">
    <router-outlet />
  </div>
</div>
